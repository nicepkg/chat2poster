# MVP PRD — Chat2Poster（浏览器扩展 + 官网）

## 范围

- 将 ChatGPT / Claude / Gemini 对话内容导出为高审美 PNG 图片（单张或多张）。
- 支持用户选择消息（默认全选、可单条/多条选择）。
- 支持主题与装饰层（圆角、padding、阴影、背景、macOS 三色条等）。
- 支持超长对话：提示分页、手动分页线、自动分页辅助（按每张最大高度智能拆分）。
- 导出倍率 1x/2x/3x；多张导出 zip 打包下载。
- 形态：浏览器扩展（WXT + Shadow DOM UI）与官网（Next.js，复用同一套渲染/导出逻辑）。

## 非范围

- 登录/账户/团队协作/云端项目保存。
- 云端存储聊天内容（包括落库、可检索的对话库）。
- 视频/GIF/动效导出。
- 自由拖拽排版编辑器（设计工具级别）。
- 标注工具（箭头/框/涂抹/文字）与复杂裁剪（MVP 不做）。

## 假设

- 用户主要目的为分享/引用，因此更重视导出质量与主题审美，而非归档。
- 三方对话页面 DOM 结构可能变化；适配器需要可独立升级；官网必须提供手动创建消息作为兜底。
- 导出引擎以 SnapDOM 为主，必要时可用 SVG 兜底。

## 依赖

- React、WXT、Next.js、shadcn/ui（或等价组件）、Tailwind（或等价样式方案）。
- react-markdown + remark/rehype 插件链。
- Shiki（或等价）用于代码高亮。
- @zumer/snapdom 导出；zip 打包库（如 fflate/jszip 之一，具体实现由工程选型决定）。

---

## 1. 一句话产品定义

给需要分享 AI 对话的人，把一段超长聊天变成审美一致、可控分页、可直接发布的图片。

## 2. 目标用户与使用场景

### 目标用户

- 开发者/产品/研究者：分享方案、代码、讨论过程。
- 内容创作者：把对话做成“海报式”内容发布。

### 高频场景

- 发推、发小红书、发公众号：需要统一审美与格式。
- 文档/PRD/报告引用：需要清晰可读的图。
- 对话超长：需要分页而不是一张无限长图。

## 3. 核心指标（MVP）

- 导出成功率：>= 99%（同一浏览器内、资源可加载前提下）。
- 首次可用时间：安装扩展后 10 秒内完成第一次导出（不含用户选择时间）。
- 导出耗时：单张 <= 3s，多张 <= 8s（同等机器条件下的目标，作为性能预算）。
- 适配器失败兜底转化：官网解析失败时 >= 60% 用户能通过“手动创建/粘贴文本”完成导出。
- 用户满意度代理指标：主题选择率（用户至少改动一次主题/装饰参数的比例）>= 30%。

## 4. MVP 能力清单（必须实现）

### 4.1 导入（Import）

扩展端：

- 从当前对话页面解析 message list（Conversation -> Messages）。
- 默认全选所有消息。
  官网端：
- 粘贴 share link：后端解析为结构化 message list（不落库）。
- 兜底：手动创建 message list（逐条添加消息）。
- 兜底：粘贴纯文本/Markdown 导入（可选输入模式，但作为“解析失败”路径必须可完成导出）。

### 4.2 选择（Selection）

- 默认全选。
- 支持单条/多条消息勾选。
- 支持快速操作：
  - 全选 / 全不选 / 仅选用户消息 / 仅选助手消息（MVP 至少全选/全不选）。

### 4.3 主题与装饰（Theme & Decoration）

- 至少提供若干预设主题（暗/亮为最低要求）。
- 可调参数（MVP 必备）：
  - 圆角（px）
  - Padding（px）
  - 阴影强度（枚举或数值）
  - 背景（纯色/渐变至少一种）
  - macOS 三色条（开关）
  - 画布宽度/比例（预设档位）
- 规则：参数改变必须立刻反馈到预览（可见性）。

### 4.4 分页（Pagination）

- 超长允许导出；当预估高度 > 6000px 显示分页提示。
- 手动分页：在消息缩略列表中，每条消息右侧提供“在此后插入分页线”。
- 自动分页（辅助）：
  - 默认每张最大高度 4096px。
  - 范围：2000–10000px。
  - 自动分页后在列表中插入分页线，并标注“第 1 张/第 2 张…”
  - 用户可删除/移动分页线后重新导出。
- 产物：
  - 单张：输出 1 张 PNG。
  - 多张：输出 N 张 PNG，并 zip 打包下载。

### 4.5 导出（Export）

- 输出格式：PNG。
- 倍率：1x/2x/3x（默认 2x）。
- 多张：zip 下载（文件命名稳定、可预测）。
- 导出后：保留当前选择与分页线，允许一键重新导出（错误恢复）。

## 5. 业务规则（可测试）

- BR-001：首次进入导出界面时，默认全选所有已解析消息。
- BR-002：当预估画布高度 > 6000px 时，必须显示分页提示；<= 6000px 不显示。
- BR-003：点击“在此后插入分页线”后，分页线必须出现在该消息之后，并立即影响导出分页结果。
- BR-004：自动分页执行后，必须插入分页线并标注页序号；页序号必须从 1 开始连续递增。
- BR-005：每张导出图的内容高度不得超过用户设置的“每张最大高度”（允许最后一张小于最大高度）。
- BR-006：导出倍率必须真实影响输出像素尺寸（例如同一宽度下 3x 像素宽度为 1x 的 3 倍）。
- BR-007：多张导出时必须生成 zip，zip 内文件名包含页序号（例如 001.png, 002.png…）。
- BR-008：导出失败必须给出可行动的恢复路径（重试 / 降级 / 兜底入口），且不得清空用户选择与分页线。
- BR-009：官网 share link 解析流程不得持久化保存对话内容；服务端日志不得记录消息正文（仅记录错误码/耗时/适配器版本）。

## 6. Glossary（术语表）

- Conversation：一次对话会话，包含消息列表与来源信息。
- Message：一条消息，包含 role 与 markdown 内容。
- Role：消息身份（user / assistant / system）。
- Selection：用户选中用于导出的消息子集（保持原顺序）。
- Theme：主题 tokens（字体、字号、颜色、气泡样式、代码块风格）。
- Decoration：装饰参数（圆角、padding、阴影、背景、macOS 条）。
- Pagination：分页，基于分页线或自动拆分生成多张图。
- Page Break / 分页线：插入在消息之间的分隔标记，作为分页边界。
- Export Job：一次导出任务，包含参数与状态。
- Adapter：解析适配器（针对 chatgpt/claude/gemini/share-link 等输入源）。

## 7. 里程碑（建议）

- M1：扩展端 ChatGPT 解析 + 单张导出（暗/亮主题、2x）可用。
- M2：选择消息 + 装饰参数 + 超长提示 + 手动分页线。
- M3：自动分页 + 多张 zip 导出 + Shiki 高亮。
- M4：官网 share link（至少 ChatGPT）+ 手动创建消息列表兜底 + 复用渲染导出逻辑。
